<!DOCTYPE html>
<html>
<head>
    <title>User Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
<h3>Welcome, {{ session['username'] }}</h3>
<a class="btn btn-danger" href="{{ url_for('logout') }}">Logout</a>

<hr>
<h4>Available Parking Lots</h4>
<table class="table table-striped">
<thead><tr><th>Lot</th><th>Price</th><th>Max Spots</th><th>Available</th><th>Action</th></tr></thead>
<tbody>
{% for lot in lots %}
<tr>
    <td>{{ lot.prime_location_name }}</td>
    <td>{{ lot.price }}</td>
    <td>{{ lot.maximum_number_of_spots }}</td>
    <td>{{ lot.spots|selectattr("status", "equalto", "A")|list|length }}</td>
    <td>
        <form action="{{ url_for('reserve_spot', lot_id=lot.id) }}" method="POST">
            <button class="btn btn-primary">Reserve</button>
        </form>
    </td>
</tr>
{% endfor %}
</tbody>
</table>

<hr>
<h4>My Reservations</h4>
<table class="table table-bordered">
<thead><tr><th>Lot</th><th>Spot</th><th>Start</th><th>Status</th><th>Action</th></tr></thead>
<tbody>
{% for res in reservations %}
<tr>
    <td>{{ res.spot.lot.prime_location_name }}</td>
    <td>{{ res.spot.id }}</td>
    <td>{{ res.parking_timestamp }}</td>
    <td>{{ "Active" if res.leaving_timestamp is none else "Completed" }}</td>
    <td>
        {% if res.leaving_timestamp is none %}
        <form action="{{ url_for('release_spot', res_id=res.id) }}" method="POST">
            <button class="btn btn-danger">Release</button>
        </form>
        {% endif %}
    </td>
</tr>
{% endfor %}
</tbody>
</table>
</body>
</html>
